---
# AgentAsKit Backpressure and Queue Alerts
groups:
  - name: backpressure
    interval: 30s
    rules:
      - alert: HighTaskQueueDepth
        expr: agentaskit_task_queue_depth > 1000
        for: 5m
        labels:
          severity: warning
          component: orchestrator
        annotations:
          summary: "High task queue depth detected"
          description: "Task queue depth is {% raw %}{{ $value }}{% endraw %} (threshold: 1000) for 5 minutes"

      - alert: CriticalTaskQueueDepth
        expr: agentaskit_task_queue_depth > 5000
        for: 2m
        labels:
          severity: critical
          component: orchestrator
        annotations:
          summary: "Critical task queue depth"
          description: "Task queue depth is {% raw %}{{ $value }}{% endraw %} (threshold: 5000)"

      - alert: MessageQueueBackpressure
        expr: rate(agentaskit_inter_agent_messages_dropped_total[1m]) > 100
        for: 3m
        labels:
          severity: warning
          component: messaging
        annotations:
          summary: "Inter-agent message backpressure detected"
          description: "Dropping {% raw %}{{ $value }}{% endraw %} messages/sec due to backpressure"

      - alert: SandboxPoolExhaustion
        expr: agentaskit_sandbox_pool_available / agentaskit_sandbox_pool_total < 0.1
        for: 2m
        labels:
          severity: warning
          component: sandbox
        annotations:
          summary: "Sandbox pool nearly exhausted"
          description: "Only {% raw %}{{ $value | humanizePercentage }}{% endraw %} of sandbox pool available"
